<%- include('../partials/header') %>

    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Live Operations Center</h1>
        <p class="text-gray-600">Real-time feed of patrol activities and incidents.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 h-screen" style="max-height: 80vh;">
        <!-- Map Area -->
        <div class="md:col-span-2">
            <%- include('../partials/live_map') %>
        </div>

        <!-- Feed Area -->
        <div class="bg-white rounded-lg shadow p-4 overflow-y-auto">
            <h3 class="text-lg font-bold mb-4 border-b pb-2">Activity Feed</h3>
            <ul id="activity-feed" class="space-y-3">
                <li class="p-3 bg-gray-50 rounded text-sm text-gray-500 text-center">Waiting for events...</li>
            </ul>
        </div>
    </div>

    <script>
        // Use the socket initialized in live_map.ejs if possible, or init here
        // ... (rest of the script)
        
        socket.on('patrol_started', (data) => {
            addFeedItem('Patrol Started', `Guard ${data.userName} started a patrol at Site ID: ${data.siteId}`);
        });

        socket.on('checkpoint_scanned', (data) => {
            addFeedItem('Checkpoint Scanned', `Checkpoint ID: ${data.checkpointId} scanned in Patrol #${data.runId}`);
        });

        socket.on('patrol_completed', (data) => {
            addFeedItem('Patrol Completed', `Patrol #${data.runId} completed with ${data.completionPercentage}%`, 'success');
        });
    </script>

    <%- include('../partials/footer') %>